---
import MainLayout from "../layouts/MainLayout.astro";
import BlogCard from "../components/BlogCard.astro";
import announcements from "../data/caliptra-announcements.json";

const posts = await Astro.glob('../data/blog/*.md');

const sortedPosts = posts.sort((a, b) => {
  return new Date(b.frontmatter.date).getTime() - new Date(a.frontmatter.date).getTime();
});
---

<MainLayout title="Caliptra Blog" description="The latest news and updates from the Caliptra project.">
  <section class="section-header" style="padding-top: 6rem;">
    <div class="container">
      <h1>Caliptra Blog</h1>
      <p class="section-description">The latest news and updates from the Caliptra project.</p>
    </div>
  </section>

  <section class="announcements-section section">
    <div class="container">
      <h2 class="caliptra-blog-subtitle">Announcements</h2>
      <ul style="padding-top: 1.5rem;">
        {announcements.announcements.map(announcement => (
          <li>
            <span>
              <strong>{announcement.date}:</strong> {announcement.title}
            </span>
          </li>
        ))}
      </ul>
    </div>
  </section>

  <section class="articles-grid section">
    <div class="container">
      <h2 class="caliptra-blog-subtitle">Articles</h2>
      <div class="articles-grid-container">
        {sortedPosts.map(post => (
          <div>
            <BlogCard post={{
              title: post.frontmatter.title,
              date: post.frontmatter.date,
              url: `/blog/${post.file.split('/').pop()?.split('.').shift()}`,
            }} />
          </div>
        ))}
      </div>
    </div>
  </section>
</MainLayout>

<style>
  .caliptra-blog-subtitle {
    text-align: center;
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 1.5rem;
    padding-bottom: 0.75rem;
    border-bottom: 1px solid var(--accent-primary);
  }

  .announcements-section ul {
    list-style-type: none;
    padding: 0;
  }

  .announcements-section li {
    margin-bottom: 1rem;
  }

  .announcements-section a {
    color: var(--text-primary);
    text-decoration: none;
  }

  .announcements-section a:hover {
    text-decoration: underline;
  }

  .articles-hero h1 {
    font-size: 2.5rem;
    margin-bottom: 1rem;
    color: var(--text-primary);
  }

  .articles-grid {
    padding-top: 2rem;
  }

  .articles-grid-container {
    padding-top: 1.5rem;
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 2rem;
  }

  @media (max-width: 768px) {
    .articles-grid-container {
      grid-template-columns: 1fr;
    }
    
    .articles-hero h1 {
      font-size: 2rem;
    }
  }
</style>
